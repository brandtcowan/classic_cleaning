<?xml version="1.0" encoding="UTF-8"?>
<root>
    <default>
        <includes>
            <!--
                Path to css and js files into plugins folder.
                If your files are not in plugins folder, use absolute paths.
            -->
            <css>
                <file>formvalidation/dist/css/formValidation.min.css</file>
            </css>
            <js>
                <file>formvalidation/dist/js/formValidation.min.js</file>
                <file>formvalidation/dist/js/framework/bootstrap.min.js</file>
            </js>
        </includes>
        <js_code>
<![CDATA[

    if($("%selector%").hasClass('material-form')) {

        // Real time validation - Material Form
        $("%selector%").formValidation({
            framework: 'bootstrap',
            row: {
                selector: '.input-field',
                valid: 'has-success',
                invalid: 'has-error'
            },
            excluded: ['.hidden-wrapper:not(.on) *'],
            onPreValidate: function(e) {

               // console.log('PreValidate');
            },
            onError: function(e) {

                // if accordion, collapse in first one with error
                if($('.panel-collapse')[0] && $('.row.has-error')[0]) {
                    $('.panel-collapse').removeClass('in').attr('aria-expanded', false);
                    var accordionError = $('.has-error:first').closest('.panel-collapse').prev('.panel-heading').find('a[data-toggle="collapse"]');
                    $(accordionError).trigger('click');
                }

                // console.log('jQuery Validation Error');
            },
            onSuccess: function(e) {

                // console.log($(e.target).data('formValidation'));
            }
        });
    } else {
        $("%selector%").formValidation({

            // Real time validation - Bootstrap Form
            framework: 'bootstrap',
            excluded: ['.hidden-wrapper:not(.on) *'],
            onPreValidate: function(e) {

               // console.log('PreValidate');
            },
            onError: function(e) {

                // if accordion, collapse in first one with error
                if($('.panel-collapse')[0] && $('.form-group.has-error')[0]) {
                $('.panel-collapse').removeClass('in').attr('aria-expanded', false);
                    var accordionError = $('.has-error:first-of-type').closest('.panel-collapse').prev('.panel-heading').find('a[data-toggle="collapse"]');
                    $(accordionError).trigger('click');
                }

                // console.log('jQuery Validation Error');
            },
            onSuccess: function(e) {

                // console.log($(e.target).data('formValidation'));
            }
        });
    }

    // DEBUG
    /* $("%selector%").find('input, select').on('change ifChanged changed.bs.select', function(e) {
        console.log($("%selector%").data('formValidation').getInvalidFields());
    }); */

    // pickadate values
    if($('.picker')[0]) {
        $('.picker').each(function() {
            var fieldName = $(this).attr('id').replace('_root', ''),
                validatorOptions = $("%selector%").data('formValidation').getOptions(fieldName);
            if(validatorOptions !== null) {
                $.each( validatorOptions.validators, function( key, value ) {
                    var currentValidator = key;
                    $("%selector%").data('formValidation').updateOption(fieldName, currentValidator, 'transformer', function($field, validatorName, validator) {
                        return $('[name="' + fieldName + '_submit"]').val();
                    });
                });
            }
            $('#' + fieldName).on('change', function() {
                $("%selector%").data('formValidation').revalidateField(fieldName);
            });
        });
    }

    // disable dependent fields validation when they're hidden
    if($('%selector% .hidden-wrapper')[0]) {
        var arr = [];
        $('%selector% .hidden-wrapper').each(function() {
            var parentField = $(this).data('parent'),
                that        = this;
            $('%selector% [name="' + parentField + '"]').on('change ifChanged changed.bs.select', function(e) {

                // switch off hidden wrapper if it has parents off
                if($(that).parents('.hidden-wrapper.off').length > 0) {
                    $(that).removeClass('on').addClass('off');
                }
                var trueFalse = $(that).hasClass('on');
                $(that).children().find('input, textarea, select').each(function() {

                    // Enable|Disable validator only if field is registered inside
                    var name = $(this).attr('name');
                    if(typeof($("%selector%").data('formValidation').options.fields[name]) != 'undefined') {
                        // Enable|Disable validator depending on dependent fields wrapper state
                        $("%selector%").formValidation('enableFieldValidators', $(this).attr('name'), trueFalse);

                        // console.log($(this).attr('name') + ' enableFieldValidators => ' + trueFalse);

                        // reset dependent fields state
                        $("%selector%").data('formValidation').updateStatus($(this).attr('name'), 'NOT_VALIDATED');

                        // re-enable submit button
                        $("%selector%").data('formValidation').disableSubmitButtons(false);

                        // console.log($(this).attr('name') + ' => NOT_VALIDATED');
                    }
                });
            });

            // trigger on load
            $('%selector% [name="' + parentField + '"]').each(function() {
                if($.inArray(parentField, arr) === -1) {
                    if($(this).next('.iCheck-helper').length > 0 && $(this).is(':checked')) {
                        // if ICheck
                        $(this).trigger('ifChanged');
                        arr.push(parentField);
                    } else if($(this).parent('.bootstrap-select').length > 0 && $(this).val() !== '') {
                        // if bootstrap-select
                        $(this).trigger('changed.bs.select');
                        arr.push(parentField);
                    } else {
                        if($(this).is(':checked') || ($(this).val() !== '' && !$(this).is(':checkbox') && !$(this).is(':radio'))) {
                            $(this).trigger('change');
                            arr.push(parentField);
                        }
                    }
                }
            });
        });
    }

    // transmit iCheck events to Validator once dependent field events have finished
    if($('%selector% .iCheck-helper')[0]) {
        $('%selector% input[type="radio"], %selector% input[type="checkbox"]').on('ifChanged', function(e) {
            if($(this).is(':checked')) {
                $("%selector%").data('formValidation').revalidateField($(e.target).attr('name'));
            }
        });
    }]]>
        </js_code>
    </default>
    <foundation>
        <includes>
            <!--
                Path to css and js files into plugins folder.
                If your files are not in plugins folder, use absolute paths.
            -->
            <css>
                <file>formvalidation/dist/css/formValidation.min.css</file>
            </css>
            <js>
                <file>formvalidation/dist/js/formValidation.min.js</file>
                <file>formvalidation/dist/js/framework/foundation.min.js</file>
            </js>
        </includes>
        <js_code>
<![CDATA[

    $("%selector%").formValidation({

        // Real time validation - Foundation Form
        framework: 'foundation',
        //err: {
        //    clazz: 'form-error',
        //    container: label
        //},
        excluded: ['.hidden-wrapper:not(.on) *'],
        onPreValidate: function(e) {

           // console.log('PreValidate');
        },
        onError: function(e) {

            // console.log('jQuery Validation Error');
        },
        onSuccess: function(e) {

            // console.log($(e.target).data('formValidation'));
        }
    });

    // DEBUG
    /* $("%selector%").find('input, select').on('change ifChanged changed.bs.select', function(e) {
        console.log($("%selector%").data('formValidation').getInvalidFields());
    }); */

    // pickadate values
    if($('.picker')[0]) {
        $('.picker').each(function() {
            var fieldName = $(this).attr('id').replace('_root', ''),
                validatorOptions = $("%selector%").data('formValidation').getOptions(fieldName);
            if(validatorOptions !== null) {
                $.each( validatorOptions.validators, function( key, value ) {
                    var currentValidator = key;
                    $("%selector%").data('formValidation').updateOption(fieldName, currentValidator, 'transformer', function($field, validatorName, validator) {
                        return $('[name="' + fieldName + '_submit"]').val();
                    });
                });
            }
            $('#' + fieldName).on('change', function() {
                $("%selector%").data('formValidation').revalidateField(fieldName);
            });
        });
    }

    // disable dependent fields validation when they're hidden
    if($('%selector% .hidden-wrapper')[0]) {
        var arr = [];
        $('%selector% .hidden-wrapper').each(function() {
            var parentField = $(this).data('parent'),
                that        = this;
            $('%selector% [name="' + parentField + '"]').on('change ifChanged changed.bs.select', function(e) {

                // switch off hidden wrapper if it has parents off
                if($(that).parents('.hidden-wrapper.off').length > 0) {
                    $(that).removeClass('on').addClass('off');
                }
                var trueFalse = $(that).hasClass('on');
                $(that).children().find('input, textarea, select').each(function() {

                    // Enable|Disable validator only if field is registered inside
                    var name = $(this).attr('name');
                    if(typeof($("%selector%").data('formValidation').options.fields[name]) != 'undefined') {
                        // Enable|Disable validator depending on dependent fields wrapper state
                        $("%selector%").formValidation('enableFieldValidators', $(this).attr('name'), trueFalse);

                        // console.log($(this).attr('name') + ' enableFieldValidators => ' + trueFalse);

                        // reset dependent fields state
                        $("%selector%").data('formValidation').updateStatus($(this).attr('name'), 'NOT_VALIDATED');

                        // re-enable submit button
                        $("%selector%").data('formValidation').disableSubmitButtons(false);

                        // console.log($(this).attr('name') + ' => NOT_VALIDATED');
                    }
                });
            });

            // trigger on load
            $('%selector% [name="' + parentField + '"]').each(function() {
                if($.inArray(parentField, arr) === -1) {
                    if($(this).next('.iCheck-helper').length > 0 && $(this).is(':checked')) {
                        // if ICheck
                        $(this).trigger('ifChanged');
                        arr.push(parentField);
                    } else if($(this).parent('.bootstrap-select').length > 0 && $(this).val() !== '') {
                        // if bootstrap-select
                        $(this).trigger('changed.bs.select');
                        arr.push(parentField);
                    } else {
                        if($(this).is(':checked') || ($(this).val() !== '' && !$(this).is(':checkbox') && !$(this).is(':radio'))) {
                            $(this).trigger('change');
                            arr.push(parentField);
                        }
                    }
                }
            });
        });
    }

    // transmit iCheck events to Validator once dependent field events have finished
    if($('%selector% .iCheck-helper')[0]) {
        $('%selector% input[type="radio"], %selector% input[type="checkbox"]').on('ifChanged', function(e) {
            if($(this).is(':checked')) {
                $("%selector%").data('formValidation').revalidateField($(e.target).attr('name'));
            }
        });
    }]]>
        </js_code>
    </foundation>
    <french>
        <includes>
            <!--
                Path to css and js files into plugins folder.
                If your files are not in plugins folder, use absolute paths.
            -->
            <css>
                <file>formvalidation/dist/css/formValidation.min.css</file>
            </css>
            <js>
                <file>formvalidation/dist/js/formValidation.min.js</file>
                <file>formvalidation/dist/js/framework/bootstrap.min.js</file>
                <file>formvalidation/i18n/dist/i18n.min.js</file>
                <file>formvalidation/dist/js/language/fr_FR.js</file>
            </js>
        </includes>
        <js_code>
<![CDATA[   if($("%selector%").hasClass('material-form')) {
        // Real time validation - Material Form
        $("%selector%").formValidation({
            framework: 'bootstrap',
            row: {
                selector: '.input-field',
                valid: 'has-success',
                invalid: 'has-error'
            },
            excluded: ['.hidden-wrapper:not(.on)'],
            onPreValidate: function(e) {

               // console.log('PreValidate');
            },
            onError: function(e) {

                // if accordion, collapse in first one with error
                if($('.panel-collapse')[0] && $('.has-error')[0]) {
                    $('.panel-collapse').removeClass('in').attr('aria-expanded', false);
                    var accordionError = $('.has-error:first').closest('.panel-collapse').prev('.panel-heading').find('a[data-toggle="collapse"]');
                    $(accordionError).trigger('click');
                }

                // console.log('jQuery Validation Error');
            },
            onSuccess: function(e) {

                // console.log($(e.target).data('formValidation'));
            },
            addOns: {
                i18n: {}
            },
            locale: 'fr_FR'
        });
    } else {
        $("%selector%").formValidation({

            // Real time validation - Bootstrap Form
            framework: 'bootstrap',
            excluded: ['.hidden-wrapper:not(.on)'],
            onPreValidate: function(e) {

               // console.log('PreValidate');
            },
            onError: function(e) {

                // if accordion, collapse in first one with error
                if($('.panel-collapse')[0] && $('.form-group.has-error')[0]) {
                    $('.panel-collapse').removeClass('in').attr('aria-expanded', false);
                    var accordionError = $('.has-error:first').closest('.panel-collapse').prev('.panel-heading').find('a[data-toggle="collapse"]');
                    $(accordionError).trigger('click');
                }

                // console.log('jQuery Validation Error');
            },
            onSuccess: function(e) {

                // console.log($(e.target).data('formValidation'));
            },
            addOns: {
                i18n: {}
            },
            locale: 'fr_FR'
        });
    }

    if($('%selector% .hidden-wrapper')[0]) {
        var arr = [];
        $('%selector% .hidden-wrapper').each(function() {
            var parentField = $(this).data('parent'),
                that        = this;
            $('%selector% [name="' + parentField + '"]').on('change ifChanged changed.bs.select', function(e) {

                // switch off hidden wrapper if it has parents off
                if($(that).parents('.hidden-wrapper.off').length > 0) {
                    $(that).removeClass('on').addClass('off');
                }
                var trueFalse = $(that).hasClass('on');
                $(that).children().find('input, textarea, select').each(function() {

                    // Enable|Disable validator only if field is registered inside
                    var name = $(this).attr('name');
                    if(typeof($("%selector%").data('formValidation').options.fields[name]) != 'undefined') {
                        // Enable|Disable validator depending on dependent fields wrapper state
                        $("%selector%").formValidation('enableFieldValidators', $(this).attr('name'), trueFalse);

                        // console.log($(this).attr('name') + ' enableFieldValidators => ' + trueFalse);

                        // reset dependent fields state
                        $("%selector%").data('formValidation').updateStatus($(this).attr('name'), 'NOT_VALIDATED');

                        // re-enable submit button
                        $("%selector%").data('formValidation').disableSubmitButtons(false);

                        // console.log($(this).attr('name') + ' => NOT_VALIDATED');
                    }
                });
            });

            // trigger on load
            $('%selector% [name="' + parentField + '"]').each(function() {
                if($.inArray(parentField, arr) === -1) {
                    if($(this).next('.iCheck-helper').length > 0 && $(this).is(':checked')) {
                        // if ICheck
                        $(this).trigger('ifChanged');
                        arr.push(parentField);
                    } else if($(this).parent('.bootstrap-select').length > 0 && $(this).val() !== '') {
                        // if bootstrap-select
                        $(this).trigger('changed.bs.select');
                        arr.push(parentField);
                    } else {
                        if($(this).is(':checked') || ($(this).val() !== '' && !$(this).is(':checkbox') && !$(this).is(':radio'))) {
                            $(this).trigger('change');
                            arr.push(parentField);
                        }
                    }
                }
            });
        });
    }

    // transmit iCheck events to Validator once dependent field events have finished
    if($('%selector% .iCheck-helper')[0]) {
        $('%selector% input[type="radio"], %selector% input[type="checkbox"]').on('ifChanged', function(e) {
            if($(this).is(':checked')) {
                $("%selector%").data('formValidation').revalidateField($(e.target).attr('name'));
            }
        });
    }]]>
        </js_code>
    </french>
</root>
